<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate Vital Signs Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900">
    <div id="dashboard"></div>

    <script>
        // Alert Triangle Icon (simplified SVG)
        const AlertTriangleIcon = () => `
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
        `;

        let dashboardData = null;

        async function loadData() {
            try {
                // Read CO2 data
                const co2Text = await window.fs.readFile('data/co2_mm_mlo.csv', { encoding: 'utf8' });
                const co2Lines = co2Text.split('\n').filter(line => !line.startsWith('#') && line.trim());
                const co2LastLine = co2Lines[co2Lines.length - 1].split(',');
                const currentCO2 = parseFloat(co2LastLine[3]);

                // Read temperature data
                const tempText = await window.fs.readFile('data/Land_and_Ocean_complete.txt', { encoding: 'utf8' });
                const tempLines = tempText.split('\n').filter(line => !line.startsWith('%') && line.trim());
                const lastTempLine = tempLines[tempLines.length - 1].trim().split(/\s+/);
                const currentTempAnomaly = parseFloat(lastTempLine[2]);

                // Read sea level data
                const seaText = await window.fs.readFile('data/CSIRO_Recons_gmsl_mo_2015.csv', { encoding: 'utf8' });
                const seaLines = seaText.split('\n').filter(line => line.trim());
                const seaLastLine = seaLines[seaLines.length - 1].split(',');
                const latestSeaLevel = parseFloat(seaLastLine[1]);
                
                const sea1993Line = seaLines.find(line => line.startsWith('1993'));
                const baseline1993 = sea1993Line ? parseFloat(sea1993Line.split(',')[1]) : 0;
                const seaLevelRise = latestSeaLevel - baseline1993;

                // Read Arctic sea ice data
                const iceText = await window.fs.readFile('data/N_09_extent_v4.0.csv', { encoding: 'utf8' });
                const iceLines = iceText.split('\n').filter(line => line.trim());
                const iceData = iceLines.slice(1).map(line => {
                    const parts = line.split(',');
                    return {
                        year: parseInt(parts[0]),
                        extent: parseFloat(parts[4])
                    };
                }).filter(d => !isNaN(d.extent) && d.extent > 0);

                const recentIce = iceData.filter(d => d.year >= 2015);
                const historicalIce = iceData.filter(d => d.year >= 1981 && d.year <= 2010);
                const recentAvg = recentIce.reduce((sum, d) => sum + d.extent, 0) / recentIce.length;
                const historicalAvg = historicalIce.reduce((sum, d) => sum + d.extent, 0) / historicalIce.length;
                const iceDecline = ((historicalAvg - recentAvg) / historicalAvg) * 100;

                dashboardData = {
                    co2: currentCO2,
                    temp: currentTempAnomaly,
                    seaLevel: seaLevelRise,
                    seaLevelRate: 3.4,
                    iceDecline: iceDecline,
                    currentIce: recentAvg,
                    historicalIce: historicalAvg
                };
                
                renderDashboard();
            } catch (error) {
                console.error('Error loading data:', error);
                // Fallback data
                dashboardData = {
                    co2: 425,
                    temp: 1.2,
                    seaLevel: 100,
                    seaLevelRate: 3.4,
                    iceDecline: 13,
                    currentIce: 4.7,
                    historicalIce: 6.5
                };
                renderDashboard();
            }
        }

        function renderDashboard() {
            if (!dashboardData) return;

            const data = dashboardData;
            
            document.getElementById('dashboard').innerHTML = `
                <div class="min-h-screen bg-gray-900 p-8">
                    <!-- Header -->
                    <div class="max-w-7xl mx-auto mb-8">
                        <div class="flex items-center justify-center gap-3 mb-2">
                            <span class="text-red-500">${AlertTriangleIcon()}</span>
                            <h1 class="text-4xl font-bold text-white">Climate Vital Signs</h1>
                            <span class="text-red-500">${AlertTriangleIcon()}</span>
                        </div>
                        <p class="text-center text-red-400 text-xl font-semibold">All Systems Critical</p>
                    </div>

                    <!-- Dashboard Grid -->
                    <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6">
                        
                        <!-- Panel 1: CO2 -->
                        <div class="bg-gray-800 rounded-lg p-6 shadow-xl">
                            <h2 class="text-xl font-bold text-white mb-4">CO₂ Concentration</h2>
                            <div class="space-y-4">
                                <div class="text-center">
                                    <div class="text-5xl font-bold text-red-400">${data.co2.toFixed(1)}</div>
                                    <div class="text-gray-400 text-sm">parts per million</div>
                                </div>
                                
                                <div class="relative h-16 bg-gray-700 rounded-lg overflow-hidden">
                                    <div class="absolute left-0 top-0 h-full bg-green-500 opacity-30" style="width: 35%"></div>
                                    <div class="absolute left-[35%] top-0 h-full bg-yellow-500 opacity-30" style="width: 40%"></div>
                                    <div class="absolute left-[75%] top-0 h-full bg-red-500 opacity-30" style="width: 25%"></div>
                                    
                                    <div class="absolute top-0 h-full w-1 bg-white" style="left: ${Math.min((data.co2 / 500) * 100, 100)}%"></div>
                                    <div class="absolute top-0 h-full flex items-center text-white font-bold" style="left: ${Math.min((data.co2 / 500) * 100, 100)}%; transform: translateX(-50%)">
                                        <div class="bg-red-600 px-2 py-1 rounded text-xs">NOW</div>
                                    </div>
                                </div>
                                
                                <div class="flex justify-between text-xs text-gray-400">
                                    <div class="flex items-center gap-1">
                                        <div class="w-3 h-3 bg-green-500 rounded"></div>
                                        <span>Safe: &lt;350 ppm</span>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <div class="w-3 h-3 bg-red-500 rounded"></div>
                                        <span>Danger: &gt;450 ppm</span>
                                    </div>
                                </div>
                                
                                <div class="text-sm text-gray-300 text-center pt-2 border-t border-gray-700">
                                    Pre-industrial: 280 ppm | Current: <span class="text-red-400 font-bold">+${(data.co2 - 280).toFixed(0)} ppm</span>
                                </div>
                            </div>
                        </div>

                        <!-- Panel 2: Temperature -->
                        <div class="bg-gray-800 rounded-lg p-6 shadow-xl">
                            <h2 class="text-xl font-bold text-white mb-4">Global Temperature Anomaly</h2>
                            <div class="space-y-4">
                                <div class="text-center">
                                    <div class="text-5xl font-bold text-orange-400">+${data.temp.toFixed(2)}°C</div>
                                    <div class="text-gray-400 text-sm">above pre-industrial</div>
                                </div>
                                
                                <div class="relative h-16 bg-gray-700 rounded-lg overflow-hidden">
                                    <div class="absolute left-0 top-0 h-full bg-green-500 opacity-30" style="width: 37.5%"></div>
                                    <div class="absolute left-[37.5%] top-0 h-full bg-yellow-500 opacity-30" style="width: 37.5%"></div>
                                    <div class="absolute left-[75%] top-0 h-full bg-red-500 opacity-30" style="width: 25%"></div>
                                    
                                    <div class="absolute top-0 h-full w-1 bg-white" style="left: ${Math.min((data.temp / 2.5) * 100, 100)}%"></div>
                                    <div class="absolute top-0 h-full flex items-center text-white font-bold" style="left: ${Math.min((data.temp / 2.5) * 100, 100)}%; transform: translateX(-50%)">
                                        <div class="bg-orange-600 px-2 py-1 rounded text-xs">NOW</div>
                                    </div>
                                </div>
                                
                                <div class="flex justify-between text-xs text-gray-400">
                                    <div class="flex items-center gap-1">
                                        <div class="w-3 h-3 bg-yellow-500 rounded"></div>
                                        <span>Target: 1.5°C</span>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <div class="w-3 h-3 bg-red-500 rounded"></div>
                                        <span>Danger: 2.0°C</span>
                                    </div>
                                </div>
                                
                                <div class="text-sm text-gray-300 text-center pt-2 border-t border-gray-700">
                                    Warming rate: <span class="text-orange-400 font-bold">~0.2°C per decade</span>
                                </div>
                            </div>
                        </div>

                        <!-- Panel 3: Sea Level -->
                        <div class="bg-gray-800 rounded-lg p-6 shadow-xl">
                            <h2 class="text-xl font-bold text-white mb-4">Sea Level Rise</h2>
                            <div class="space-y-4">
                                <div class="text-center">
                                    <div class="text-5xl font-bold text-blue-400">+${data.seaLevel.toFixed(0)}mm</div>
                                    <div class="text-gray-400 text-sm">since 1993</div>
                                </div>
                                
                                <div class="relative h-32 bg-gray-700 rounded-lg overflow-hidden">
                                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-blue-500 to-blue-400 transition-all duration-1000" style="height: ${Math.min((data.seaLevel / 150) * 100, 100)}%">
                                        <div class="absolute top-0 left-0 right-0 h-2 bg-white opacity-50"></div>
                                    </div>
                                    
                                    <div class="absolute bottom-0 left-0 right-0 flex items-end justify-center pb-2" style="height: ${Math.min((data.seaLevel / 150) * 100, 100)}%">
                                        <div class="bg-white text-blue-900 px-3 py-1 rounded text-sm font-bold">Current</div>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div class="text-center p-2 bg-gray-700 rounded">
                                        <div class="text-gray-400 text-xs">Current Rate</div>
                                        <div class="text-blue-400 font-bold">${data.seaLevelRate} mm/year</div>
                                    </div>
                                    <div class="text-center p-2 bg-gray-700 rounded">
                                        <div class="text-gray-400 text-xs">Projected 2100</div>
                                        <div class="text-blue-400 font-bold">~300-1000 mm</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Panel 4: Arctic Ice -->
                        <div class="bg-gray-800 rounded-lg p-6 shadow-xl">
                            <h2 class="text-xl font-bold text-white mb-4">Arctic Sea Ice (September)</h2>
                            <div class="space-y-4">
                                <div class="text-center">
                                    <div class="text-5xl font-bold text-cyan-400">-${data.iceDecline.toFixed(1)}%</div>
                                    <div class="text-gray-400 text-sm">decline from 1981-2010 average</div>
                                </div>
                                
                                <div class="space-y-2">
                                    <div>
                                        <div class="flex justify-between text-xs text-gray-400 mb-1">
                                            <span>1981-2010 Average</span>
                                            <span>${data.historicalIce.toFixed(1)} million km²</span>
                                        </div>
                                        <div class="h-8 bg-cyan-600 rounded"></div>
                                    </div>
                                    
                                    <div>
                                        <div class="flex justify-between text-xs text-gray-400 mb-1">
                                            <span>Recent Average (2015+)</span>
                                            <span>${data.currentIce.toFixed(1)} million km²</span>
                                        </div>
                                        <div class="h-8 bg-cyan-400 rounded relative" style="width: ${(data.currentIce / data.historicalIce) * 100}%">
                                            <div class="absolute right-0 top-0 bottom-0 flex items-center pr-2">
                                                <span class="text-xs font-bold text-gray-900">NOW</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-sm text-gray-300 text-center pt-2 border-t border-gray-700">
                                    Decline rate: <span class="text-cyan-400 font-bold">~13% per decade</span>
                                </div>
                                
                                <div class="text-xs text-gray-400 text-center">
                                    Ice-free summers projected by 2040s
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="max-w-7xl mx-auto mt-8 text-center text-gray-500 text-sm">
                        <p>Data sources: NOAA (CO₂), Berkeley Earth (Temperature), CSIRO (Sea Level), NSIDC (Arctic Ice)</p>
                        <p class="mt-2">Last updated: ${new Date().toLocaleDateString()}</p>
                    </div>
                </div>
            `;
        }

        // Initialize
        loadData();
    </script>
</body>
</html>